{% load static %}
{% load user_extras %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}ShopX{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col min-h-screen bg-gray-50">

  <!-- Navbar -->
  <header class="bg-gray-900 text-white shadow-md">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-4 md:px-8 h-16">
      <a href="/" class="flex items-center gap-2 group">
        <img src="{% static 'project_logo.png' %}" alt="ShopX Logo" class="h-8 w-auto transition-transform duration-300 group-hover:scale-105">
        <span class="text-2xl font-bold hover:text-gray-300">Shop<span class="bg-gradient-to-r from-red-500 to-red-600 text-transparent bg-clip-text hover:from-red-600 hover:to-red-700 transition-all duration-300">X</span></span>
      </a>
      <nav class="flex items-center gap-4 md:gap-6 flex-wrap">
        <a class="hover:text-gray-300" href="/">Home</a>
        <a class="hover:text-gray-300" href="{% url 'products:category_list' 'children' %}">Children</a>
        <a class="hover:text-gray-300" href="{% url 'products:category_list' 'men' %}">Men</a>
        <a class="hover:text-gray-300" href="{% url 'products:category_list' 'women' %}">Women</a>
        <a class="hover:text-gray-300" href="/products/cart/">Cart</a>
        {% if user.is_authenticated %}
          {% if user.is_superuser or user|is_admin %}
            <a class="hover:text-gray-300 bg-green-600 px-3 py-1 rounded" href="{% url 'products:add_product' %}">Add Product</a>
          {% endif %}
        {% endif %}
        {% if user.is_authenticated %}
          <a class="hover:text-gray-300" href="/accounts/logout/">Logout</a>
        {% else %}
          <a class="hover:text-gray-300" href="/accounts/login/">Login</a>
          <a class="hover:text-gray-300" href="/accounts/register/">Register</a>
        {% endif %}
        <form action="/products/search/" method="get" class="flex items-center border border-gray-300 rounded overflow-hidden">
          <input name="q" placeholder="Search products" class="px-2 py-1 outline-none text-gray-800" />
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1">Search</button>
        </form>
      </nav>
    </div>
  </header>

  <!-- Flash messages -->
  {% if messages %}
  <div class="max-w-7xl mx-auto p-4">
    {% for message in messages %}
      <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-3 mb-2 rounded-md shadow-sm">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Main content -->
  <main class="flex-1 max-w-7xl mx-auto px-4 md:px-8 py-6">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400 mt-8">
    <div class="max-w-7xl mx-auto px-4 md:px-8 py-6 text-center text-sm">
      <p>&copy; {{ now|date:'Y' }} ShopX. All rights reserved.</p>
      <p>Contact: 2110018@student.ruet.ac.bd.com</p>
    </div>
  </footer>

  <script src="{% static 'js/cart.js' %}"></script>
  <script>
    (function(){
      const container = document.getElementById('hero-tiles');
      if(!container) return;
      const tiles = container.querySelectorAll('a');
      if(tiles.length < 3) return;
      // Keep a constant order; only animate tiles every cycle
      const orders = [[0,1,2]];
      let i = 0;
      function applyOrder(){
        const order = orders[0];
        // put tiles to the right, no transition yet
        tiles.forEach((t, idx)=>{
          t.style.order = order.indexOf(idx);
          t.style.willChange = 'transform, opacity';
          t.style.transition = 'none';
          t.style.transform = 'translateX(100%)';
          t.style.opacity = '0';
        });
        // next frame: enable transition
        requestAnimationFrame(()=>{
          tiles.forEach((t)=>{
            t.style.transition = 'transform 1s ease, opacity 1s ease';
          });
          // next frame: animate to place
          requestAnimationFrame(()=>{
            tiles.forEach((t)=>{
              t.style.transform = 'translateX(0)';
              t.style.opacity = '1';
            });
          });
        });
      }
      applyOrder();
    })();
  </script>
</body>
</html>
